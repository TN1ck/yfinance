(ns in.freegeek.yfinance-test
  (:use [in.freegeek.yfinance] :reload-all)
  (:use [clojure.test]))

(deftest aapl-ibm-test
  (let [{IBM "IBM" AAPL "AAPL" non-existent-symbol "non-existent-symbol"} (fetch-historical-data "2009-01-01"
                                                                      "2009-01-15"
                                                                      ["AAPL" "IBM" "non-existent-symbol"])]
    (is (= IBM  [{:adjusted_close 77.18, :volume 11734800, :close 84.12, :low 82.26, :high 84.83, :open 83.61, :trading_date "2009-01-15"} {:adjusted_close 76.33, :volume 9470000, :close 83.19, :low 82.11, :high 84.82, :open 84.2, :trading_date "2009-01-14"} {:adjusted_close 78.3, :volume 7657200, :close 85.34, :low 84.79, :high 86.59, :open 85.5, :trading_date "2009-01-13"} {:adjusted_close 78.64, :volume 8072700, :close 85.71, :low 84.42, :high 86.6, :open 84.57, :trading_date "2009-01-12"} {:adjusted_close 77.72, :volume 7440300, :close 84.7, :low 84.25, :high 87.5, :open 87.05, :trading_date "2009-01-09"} {:adjusted_close 79.99, :volume 7231800, :close 87.18, :low 85.98, :high 88.14, :open 87.81, :trading_date "2009-01-08"} {:adjusted_close 80.55, :volume 8455100, :close 87.79, :low 87.12, :high 88.8, :open 87.83, :trading_date "2009-01-07"} {:adjusted_close 81.87, :volume 9649500, :close 89.23, :low 86.37, :high 90.41, :open 87.11, :trading_date "2009-01-06"} {:adjusted_close 79.66, :volume 8315700, :close 86.82, :low 86.18, :high 87.67, :open 86.42, :trading_date "2009-01-05"} {:adjusted_close 80.17, :volume 7558200, :close 87.37, :low 83.89, :high 87.59, :open 83.89, :trading_date "2009-01-02"}]))
    (is (= AAPL [{:adjusted_close 81.09, :volume 65415500, :close 83.38, :low 80.05, :high 84.12, :open 80.57, :trading_date "2009-01-15"} {:adjusted_close 82.99, :volume 36488000, :close 85.33, :low 84.72, :high 87.25, :open 86.24, :trading_date "2009-01-14"} {:adjusted_close 85.3, :volume 28514200, :close 87.71, :low 86.35, :high 89.74, :open 88.24, :trading_date "2009-01-13"} {:adjusted_close 86.23, :volume 22061300, :close 88.66, :low 87.55, :high 90.99, :open 90.46, :trading_date "2009-01-12"} {:adjusted_close 88.09, :volume 19530200, :close 90.58, :low 90.14, :high 93.38, :open 93.21, :trading_date "2009-01-09"} {:adjusted_close 90.16, :volume 23912000, :close 92.7, :low 90.04, :high 93.15, :open 90.43, :trading_date "2009-01-08"} {:adjusted_close 88.51, :volume 26894600, :close 91.01, :low 90.26, :high 92.5, :open 91.81, :trading_date "2009-01-07"} {:adjusted_close 90.47, :volume 46046800, :close 93.02, :low 92.39, :high 97.17, :open 95.95, :trading_date "2009-01-06"} {:adjusted_close 91.98, :volume 42200300, :close 94.58, :low 92.71, :high 96.18, :open 93.17, :trading_date "2009-01-05"} {:adjusted_close 88.26, :volume 26643400, :close 90.75, :low 85.16, :high 91.04, :open 85.88, :trading_date "2009-01-02"}]))
    (is (= non-existent-symbol 404))))
